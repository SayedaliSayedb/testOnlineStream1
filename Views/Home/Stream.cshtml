@{
    ViewData["Title"] = "پخش زنده - WebRTC";
}

<div class="row">
    <div class="col-12 text-center mb-4">
        <h1 class="text-white display-4 fw-bold">🎬 پخش زنده</h1>
        <p class="text-white-50 lead">پخش ویدیوی خود را با تأخیر کم و کیفیت بالا شروع کنید</p>
    </div>
</div>

<div class="row g-4">
    <!-- بخش پخش کننده -->
    <div class="col-lg-8">
        <div class="card stats-card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-broadcast"></i> پخش کننده</h5>
            </div>
            <div class="card-body">
                <div class="video-container mb-3">
                    <video id="localVideo" autoplay muted playsinline
                           class="w-100" style="max-height: 500px;"></video>
                </div>

                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="form-group">
                            <label for="streamTitle" class="form-label">عنوان پخش:</label>
                            <input type="text" class="form-control" id="streamTitle"
                                   placeholder="عنوان پخش زنده خود را وارد کنید" value="پخش زنده من">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">وضعیت:</label>
                            <div>
                                <span id="streamStatus" class="badge bg-secondary">آفلاین</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <button id="startStreamBtn" class="btn btn-success btn-stream">
                        <i class="bi bi-play-fill"></i> شروع پخش
                    </button>
                    <button id="stopStreamBtn" class="btn btn-danger btn-stream" disabled>
                        <i class="bi bi-stop-fill"></i> توقف پخش
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- بخش بینندگان و اطلاعات -->
    <div class="col-lg-4">
        <div class="card stats-card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-people-fill"></i> بینندگان</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <h3 id="viewerCount" class="text-primary">0</h3>
                    <small class="text-muted">بیننده آنلاین</small>
                </div>

                <div class="viewer-list">
                    <div id="viewersList" class="list-group">
                        <!-- لیست بینندگان اینجا نمایش داده می‌شود -->
                    </div>
                </div>

                <div class="mt-3">
                    <div class="alert alert-info">
                        <small>
                            <i class="bi bi-info-circle"></i>
                            <strong>راهنما:</strong> پس از شروع پخش، بینندگان می‌توانند از صفحه "مشاهده" به پخش شما بپیوندند.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/webrtc-streamer.js"></script>
}